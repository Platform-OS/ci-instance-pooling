---
slug: api/instances/reserve
method: post
---
{% liquid
  function instance = 'lib/queries/instances/find_by_client', client: context.params.client, available: false
  if instance
    response_status 503
    echo '{"error": "Instance already reserved. Please release or wait for auto-realeasing"}'
  else
    function instance = 'lib/queries/instances/find_available' reserved_by: context.params.client
    if instance
      function command = 'lib/commands/instances/reserve', reserved_by: context.params.client, instance_id: instance.id
      function release = 'lib/commands/instances/release', instance_id: instance.id, reserved_by: context.params.client, delay: 45

      echo command.domain
    else
      response_status 503
      echo '{"error": "no available instances"}'
    endif
  endif

%}
