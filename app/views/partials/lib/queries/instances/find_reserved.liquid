{% liquid
  if reserved_by == blank
    log 'reserved_by is blank. Cowardly refusing to proceed with searching'
    return null
  endif

  if id == blank
    log 'id is blank. Cowardly refusing to proceed with searching'
    return null
  endif

  log available, type: 'available'

  graphql r = 'instances/search', limit: 1, id: id, reserved_by: reserved_by, available: false

  return r.records.results.first
%}
