{% liquid
  if reserved_by == blank
    log 'reserved_by is blank. Cowardly refusing to proceed with searching'
    return null
  endif

  log available, type: 'available'

  graphql r = 'instances/search', limit: 1, reserved_by: reserved_by, available: available
  include 'lib/handle_graphql_response', r: r, name: 'queries/instances/search'

  return r.records.results.first
%}
